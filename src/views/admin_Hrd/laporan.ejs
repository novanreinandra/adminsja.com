<%- include('partials/header') %>
<div id="wrapper">
  <div id="content-wrapper" class="d-flex flex-column">
    <div id="content">
      <%- include('partials/navbar') %>

      <div class="main-panel">
        <div class="content-wrapper">
          <div class="row">
            <div class="container-fluid">
              <div class="card shadow-sm mb-4">
                <div class="card-body bg-white">

                  <!-- Judul -->
                  <div class="row align-items-center mb-3 g-3">
                    <div class="col-lg-6">
                      <h3 class="mb-2">
                        <i class="bi bi-file-earmark-bar-graph menu-icon"></i>
                        Laporan Bulanan Karyawan
                      </h3>
                      <hr>
                    </div>
                    <div class="col-lg-6 d-flex justify-content-end gap-2">
                      <a href="/admin_gudang/cetak_laporan" target="_blank" class="btn btn-dark btn-sm rounded-pill px-4">
                        <i class="bi bi-printer me-1"></i> Cetak PDF
                      </a>
                      <a href="/admin_gudang/export_excel" target="_blank" class="btn btn-success btn-sm rounded-pill px-4">
                        <i class="bi bi-file-earmark-excel me-1"></i> Ekspor Excel
                      </a>
                    </div>
                  </div>

                  <!-- Filter -->
                  <div class="card p-3 bg-light mb-4">
                    <form id="filterForm" class="row g-3 align-items-end">
                      <div class="col-md-4">
                        <label for="bulanFilter" class="form-label fw-semibold">Bulan & Tahun</label>
                        <input type="month" id="bulanFilter" class="form-control" />
                      </div>
                      <div class="col-md-4">
                        <label for="karyawanFilter" class="form-label fw-semibold">Nama Karyawan</label>
                        <select id="karyawanFilter" class="form-select">
                          <option value="">Semua</option>
                          <option>Adi</option>
                          <option>Arif</option>
                          <option>Agun</option>
                          <option>Agus</option>
                          <option>Aman Sejahtera</option>
                          <option>Andin</option>
                          <option>Aria Pratama</option>
                          <option>Armilda Sandraningtyas</option>
                          <option>Bagja</option>
                          <option>Brata</option>
                          <option>Bella</option>
                          <option>Deni</option>
                          <option>Dewi</option>
                          <option>Dian</option>
                          <option>Echa</option>
                          <option>Fready</option>
                          <option>Gugun</option>
                          <option>Hanan</option>
                          <option>Hermawan</option>
                          <option>Imel</option>
                          <option>Irfan Dwi</option>
                          <option>Iwan</option>
                          <option>Jay</option>
                          <option>Kusnadi</option>
                          <option>Laras</option>
                          <option>Laota</option>
                          <option>Mei</option>
                          <option>Norma</option>
                          <option>Octorianto Saputra</option>
                          <option>Otong</option>
                          <option>Revi</option>
                          <option>Rizki</option>
                          <option>Rully Kristanto</option>
                          <option>Sony Turang</option>
                          <option>Sri</option>
                          <option>Tantri Sandilah</option>
                          <option>Yanuar</option>
                          <option>Yuli</option>
                        </select>
                      </div>
                      <div class="col-md-4 d-flex justify-content-end">
                        <button type="button" class="btn btn-primary" style="background-color: #0d6efd; color: #ffffff;">
                          <i class="bi bi-funnel me-1"></i> Terapkan Filter
                        </button>
                      </div>
                    </form>
                  </div>

                  <!-- =============================== -->
                  <!-- TABEL LAPORAN KARYAWAN -->
                  <!-- =============================== -->
                  <div class="table-responsive">
                    <table class="table">
                      <thead class="table-light text-center">
                        <tr>
                          <th>No.</th>
                          <th>Nama</th>
                          <th>Jabatan</th>
                          <th>Bulan</th>
                          <th>Lembur (Jam)</th>
                          <th>Gaji Bersih</th>
                          <th>Aksi</th>
                        </tr>
                      </thead>
                      <tbody>
                        <% const dataKaryawan = [
                          { id: 1, nama: "Irfan Dwi", jabatan: "Kepala Gudang", lembur: 5, gaji: "Rp 3.500.000", bulan: "Agustus 2025" },
                          { id: 3, nama: "Octorianto Saputra", jabatan: "Direktur Marketing", lembur: 6, gaji: "Rp 8.200.000", bulan: "Agustus 2025" },
                          { id: 4, nama: "Armilda Sandraningtyas", jabatan: "Admin Service", lembur: 4, gaji: "Rp 2.700.000", bulan: "Agustus 2025" }
                        ]; %>

                        <% dataKaryawan.forEach((d, index) => { %>
                        <tr class="text-center">
                          <td><%= index + 1 %></td>
                          <td><%= d.nama %></td>
                          <td><%= d.jabatan %></td>
                          <td><%= d.bulan %></td>
                          <td><%= d.lembur %></td>
                          <td><%= d.gaji %></td>
                          <td>
                            <button 
                              class="btn btn-secondary btn-sm rounded-pill px-3"
                              data-bs-toggle="modal"
                              data-bs-target="#modalKaryawan<%= d.id %>">
                              <i class="bi bi-eye"></i> Detail
                            </button>
                          </td>
                        </tr>
                        <% }); %>
                      </tbody>
                    </table>
                  </div>

                  <!-- Pagination -->
                  <nav aria-label="Navigasi halaman karyawan" class="mt-3">
                    <ul class="pagination justify-content-end">
                      <li class="page-item disabled">
                        <a class="page-link" href="#" tabindex="-1" aria-disabled="true">Sebelumnya</a>
                      </li>
                      <li class="page-item active" aria-current="page">
                        <a class="page-link" href="#">1</a>
                      </li>
                      <li class="page-item"><a class="page-link" href="#">2</a></li>
                      <li class="page-item"><a class="page-link" href="#">3</a></li>
                      <li class="page-item">
                        <a class="page-link" href="#">Selanjutnya</a>
                      </li>
                    </ul>
                  </nav>

                  <!-- Modal Detail -->
                  <% dataKaryawan.forEach(k => { %>
                    <div class="modal fade" id="modalKaryawan<%= k.id %>" tabindex="-1" aria-hidden="true">
                      <div class="modal-dialog modal-lg modal-dialog-centered">
                        <div class="modal-content border-0 shadow-lg rounded-4 overflow-hidden">
                          
                          <!-- Header -->
                          <div class="modal-header bg-gradient text-dark" style="background: linear-gradient(45deg, #007bff, #00c4ff);">
                            <div>
                              <h5 class="modal-title fw-bold mb-0">Detail Laporan Karyawan</h5>
                              <small><i class="bi bi-person-circle me-1"></i> <%= k.nama %> â€” <%= k.bulan %></small>
                            </div>
                            <button type="button" class="btn-close btn-close-dark" data-bs-dismiss="modal"></button>
                          </div>

                          <!-- Body -->
                          <div class="modal-body bg-default p-4">
                            <ul class="list-group list-group-flush">
                              <li class="list-group-item d-flex justify-content-between align-items-center">
                                <span><i class="bi bi-calendar-week text-primary me-2"></i><strong>Bulan</strong></span>
                                <span><%= k.bulan %></span>
                              </li>
                              <li class="list-group-item d-flex justify-content-between align-items-center">
                                <span><i class="bi bi-calendar-check text-success me-2"></i><strong>Hari Kerja</strong></span>
                                <span>22</span>
                              </li>
                              <li class="list-group-item d-flex justify-content-between align-items-center">
                                <span><i class="bi bi-person-check text-success me-2"></i><strong>Hadir</strong></span>
                                <span>20</span>
                              </li>
                              <li class="list-group-item d-flex justify-content-between align-items-center">
                                <span><i class="bi bi-clock-history text-warning me-2"></i><strong>Terlambat</strong></span>
                                <span>2</span>
                              </li>
                              <li class="list-group-item d-flex justify-content-between align-items-center">
                                <span><i class="bi bi-airplane text-info me-2"></i><strong>Cuti</strong></span>
                                <span>1</span>
                              </li>
                              <li class="list-group-item d-flex justify-content-between align-items-center">
                                <span><i class="bi bi-person-x text-danger me-2"></i><strong>Alpha</strong></span>
                                <span>1</span>
                              </li>
                              <li class="list-group-item d-flex justify-content-between align-items-center">
                                <span><i class="bi bi-lightning-charge text-primary me-2"></i><strong>Lembur</strong></span>
                                <span><%= k.lembur %> Jam</span>
                              </li>
                              <li class="list-group-item d-flex justify-content-between align-items-center">
                                <span><i class="bi bi-dash-circle text-danger me-2"></i><strong>Potongan</strong></span>
                                <span>Rp 100.000</span>
                              </li>
                              <li class="list-group-item d-flex justify-content-between align-items-center">
                                <span><i class="bi bi-plus-circle text-success me-2"></i><strong>Tambahan</strong></span>
                                <span>Rp 75.000</span>
                              </li>
                            </ul>

                            <!-- Gaji Bersih -->
                            <div class="mt-4 p-3 text-center bg-dark text-white rounded-3">
                              <h6 class="mb-1 fw-bold"><i class="bi bi-cash-stack me-2"></i>Gaji Bersih</h6>
                              <h3 class="fw-bold mb-0"><%= k.gaji %></h3>
                            </div>
                          </div>

                          <!-- Footer -->
                          <div class="modal-footer border-0">
                            <button type="button" class="btn btn-secondary rounded-pill px-4" data-bs-dismiss="modal">
                              <i class="bi bi-x-circle me-1"></i> Tutup
                            </button>
                          </div>

                        </div>
                      </div>
                    </div>
                  <% }); %>

                </div>
              </div>
            </div>
          </div>
        </div>

<%- include('partials/footer') %>

<script>
  const searchInput = document.getElementById('searchInput');
  const tableRows = document.querySelectorAll('#laporanTable tbody tr');
  searchInput.addEventListener('keyup', () => {
    const value = searchInput.value.toLowerCase();
    tableRows.forEach(row => {
      const text = row.textContent.toLowerCase();
      row.style.display = text.includes(value) ? '' : 'none';
    });
  });
  document.querySelectorAll('[data-bs-toggle="tooltip"]').forEach(el => new bootstrap.Tooltip(el));
</script>
