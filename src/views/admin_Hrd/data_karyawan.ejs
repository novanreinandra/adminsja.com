<style>
  #tabelkaryawan {
    font-size: 10px; 
  }

  #tabelkaryawan th,
  #tabelkaryawan td {
    padding: 8px 8px; 
    vertical-align: middle;
  }

  #tabelkaryawan th {
    font-weight: 600;
  }
</style>

<%- include('partials/header') %>

<div id="wrapper">
  <div id="content-wrapper" class="d-flex flex-column">
    <div id="content">
      <%- include('partials/navbar') %>

      <div class="main-panel">
        <div class="content-wrapper">
          <div class="container-fluid">

            <!-- ======================================================= -->
            <!-- BAGIAN DATA KARYAWAN -->
            <!-- ======================================================= -->
            <div class="card shadow-sm mb-5 border-0">
              <div class="card-body bg-white">
                <div class="row align-items-start mb-3 g-3">
                  <div class="col-lg-6 col-md-12">
                    <h3 class="mb-2">
                      <i class="bi bi-people-fill me-2"></i> Data Karyawan
                    </h3>
                    <p>Daftar seluruh karyawan yang terdaftar dalam sistem</p>
                    <hr>
                  </div>
                  <div class="col-lg-6 d-flex justify-content-end align-items-center">
                    <button class="btn btn-primary rounded-pill px-4"
                            data-bs-toggle="modal"
                            data-bs-target="#modalTambahKaryawan"
                            style="background-color: #0d6efd;">
                      <i class="bi bi-person-plus me-2"></i> Tambah Karyawan
                    </button>
                  </div>
                </div>

                <div class="table-responsive">
                  <table class="table table-hover align-middle text-center" id="tabelkaryawan">
                    <thead class="table-light">
                      <tr>
                        <th>No</th>
                        <th>ID Company</th>
                        <th>ID Dept</th>
                        <th>ID Jabatan</th>
                        <th>Nama Lengkap</th>
                        <th>Email</th>
                        <th>Status</th>
                        <th>Jenis</th>
                        <th>Tgl Masuk</th>
                        <th>Aksi</th>
                      </tr>
                    </thead>
                    <tbody>
                      <% if (!dataKaryawan || dataKaryawan.length === 0) { %>
                        <tr>
                          <td colspan="10" class="text-muted">Belum ada data karyawan</td>
                        </tr>
                      <% } else { %>
                        <% dataKaryawan.forEach((k, i) => { 
                             const tglMasuk = k.tgl_masuk 
                               ? (new Date(k.tgl_masuk)).toISOString().split('T')[0]
                               : '-';
                        %>
                          <tr>
                            <td><%= i + 1 %></td>
                            <td><%= k.id_company %></td>
                            <td><%= k.id_department %></td>
                            <td><%= k.id_jabatan %></td>
                            <td class="text-start"><%= k.nama_lengkap %></td>
                            <td><%= k.email %></td>
                            <td>
                              <span class="badge <%= k.status_karyawan === 'Tetap' ? 'bg-success' : 'bg-warning' %> rounded-pill px-3 py-2">
                                <%= k.status_karyawan %>
                              </span>
                            </td>
                            <td><%= k.jenis_karyawan %></td>
                            <td><%= tglMasuk %></td>
                            <td>
                             <div class="d-flex gap-1 justify-content-center">
                               <button class="btn btn-sm btn-secondary rounded-pill px-3 me-2"
                                      data-bs-toggle="modal"
                                      data-bs-target="#modalDetailKaryawan<%= k.id_karyawan %>">
                                <i class="bi bi-eye"></i> Detail
                              </button>

                              <button class="btn btn-sm btn-danger rounded-pill px-3 text-white"
                                      data-bs-toggle="modal"
                                      data-bs-target="#modalHapusKaryawan<%= k.id_karyawan %>">
                                <i class="bi bi-trash"></i> Hapus
                              </button>
                             </div>
                            </td>
                          </tr>
                        <% }) %>
                      <% } %>
                    </tbody>
                  </table>
                </div>

                <!-- Pagination -->
                <nav aria-label="Navigasi halaman karyawan" class="mt-3">
                  <ul class="pagination justify-content-end">
                    <li class="page-item disabled">
                      <a class="page-link" href="#" tabindex="-1" aria-disabled="true">Sebelumnya</a>
                    </li>
                    <li class="page-item active" aria-current="page">
                      <a class="page-link" href="#">1</a>
                    </li>
                    <li class="page-item"><a class="page-link" href="#">2</a></li>
                    <li class="page-item"><a class="page-link" href="#">3</a></li>
                    <li class="page-item">
                      <a class="page-link" href="#">Selanjutnya</a>
                    </li>
                  </ul>
                </nav>
              </div>
            </div>

            <!-- ======================= MODAL DETAIL KARYAWAN ======================= -->
            <% if (dataKaryawan && dataKaryawan.length > 0) { %>
              <% dataKaryawan.forEach(k => { 
                  const tglMasuk = k.tgl_masuk 
                    ? (new Date(k.tgl_masuk)).toISOString().split('T')[0]
                    : '-';

                  // Ambil nama / status / jenis / jabatan / company
                  const status = k.status_karyawan?.nama || k.status_karyawan || '-';
                  const jenis = k.jenis_karyawan?.tipe || k.jenis_karyawan || '-';
                  const jabatan = k.jabatan?.nama_jabatan || k.jabatan || '-';
                  const company = k.company?.nama_company || k.company || '-';
                  const department = k.department?.nama_department || k.department || '-';

                  // Badge warna status
                  let statusBadge = '';
                  switch ((status || '').toLowerCase()) {
                    case 'aktif':
                      statusBadge = `<span class="badge bg-success-subtle text-success px-3 py-1">
                                      <i class="bi bi-check-circle me-1"></i>Aktif
                                    </span>`;
                      break;
                    case 'kontrak':
                      statusBadge = `<span class="badge bg-primary-subtle text-primary px-3 py-1">
                                      <i class="bi bi-briefcase me-1"></i>Kontrak
                                    </span>`;
                      break;
                    case 'tetap':
                      statusBadge = `<span class="badge bg-info-subtle text-info px-3 py-1">
                                      <i class="bi bi-shield-check me-1"></i>Tetap
                                    </span>`;
                      break;
                    case 'cuti':
                      statusBadge = `<span class="badge bg-warning-subtle text-warning px-3 py-1">
                                      <i class="bi bi-airplane me-1"></i>Cuti
                                    </span>`;
                      break;
                    default:
                      statusBadge = `<span class="badge bg-danger-subtle text-danger px-3 py-1">
                                      <i class="bi bi-x-circle me-1"></i>Tidak Aktif
                                    </span>`;
                  }
              %>

                <div class="modal fade" id="modalDetailKaryawan<%= k.id_karyawan %>" tabindex="-1" aria-labelledby="detailLabel<%= k.id_karyawan %>" aria-hidden="true">
                  <div class="modal-dialog modal-dialog-centered modal-lg">
                    <div class="modal-content border-0 shadow-lg rounded-4 overflow-hidden animate__animated animate__fadeInDown">
                      
                      <!-- Header -->
                      <div class="modal-header bg-gradient text-white py-3 px-4" style="background-color:  #3c3c51">
                        <h5 class="modal-title fw-bold d-flex align-items-center" id="detailLabel<%= k.id_karyawan %>">
                          <i class="bi bi-person-vcard me-2"></i> Detail Karyawan
                        </h5>
                        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                      </div>

                      <!-- Body -->
                      <div class="modal-body bg-light p-4">
                        <div class="row g-4 align-items-center">

                          <!-- Foto Profil -->
                          <div class="col-md-4 text-center">
                            <div class="position-relative d-inline-block">
                              <img src="https://ui-avatars.com/api/?name=<%= encodeURIComponent(k.nama_lengkap || 'Karyawan') %>&background=0D6EFD&color=fff&size=128&rounded=true"
                                  alt="Foto Karyawan" class="rounded-circle shadow-sm mb-3" width="120" height="120">
                              <span class="position-absolute bottom-0 end-0 translate-middle p-2 bg-success border border-light rounded-circle">
                                <i class="bi bi-check-lg text-white"></i>
                              </span>
                            </div>
                            <h6 class="fw-bold mt-2 mb-0 text-success"><%= k.nama_lengkap %></h6>
                            <p class="text-muted small mb-0"><%= jabatan %></p>
                            <span class="badge bg-gradient bg-success-subtle text-success mt-2 px-3 py-1">
                              <i class="bi bi-briefcase-fill me-1"></i><%= jenis %>
                            </span>
                          </div>

                          <!-- Detail Info -->
                          <div class="col-md-8">
                            <div class="card border-0 shadow-sm rounded-3">
                              <div class="card-body p-3">
                                <dl class="row mb-0">
                                  <dt class="col-sm-4 text-dark">ID Karyawan</dt>
                                  <dd class="col-sm-8 fw-semibold"><%= k.id_karyawan %></dd>

                                  <dt class="col-sm-4 text-dark">Perusahaan</dt>
                                  <dd class="col-sm-8"><i class="bi bi-building me-1"></i><%= company %></dd>

                                  <dt class="col-sm-4 text-dark">Departemen</dt>
                                  <dd class="col-sm-8"><i class="bi bi-diagram-3 me-1"></i><%= department %></dd>

                                  <dt class="col-sm-4 text-dark">Email</dt>
                                  <dd class="col-sm-8"><%= k.email || '-' %></dd>

                                  <dt class="col-sm-4 text-dark">Status</dt>
                                  <dd class="col-sm-8"><%- statusBadge %></dd>

                                  <dt class="col-sm-4 text-dark">Tanggal Masuk</dt>
                                  <dd class="col-sm-8"><i class="bi bi-calendar-check me-1"></i><%= tglMasuk %></dd>
                                </dl>
                              </div>
                            </div>
                          </div>

                        </div>
                      </div>

                      <!-- Footer -->
                      <div class="modal-footer bg-white border-top">
                        <button class="btn btn-dark rounded-pill px-4" data-bs-dismiss="modal" style="background-color:  #3c3c51">
                          <i class="bi bi-x-circle me-1"></i> Tutup
                        </button>
                      </div>

                    </div>
                  </div>
                </div>

                <!-- ==================== MODAL HAPUS KARYAWAN (MODERN DAN SEIMBANG) ==================== -->
                <div class="modal fade" id="modalHapusKaryawan<%= k.id_karyawan %>" tabindex="-1" aria-hidden="true">
                  <div class="modal-dialog modal-dialog-centered">
                    <div class="modal-content border-0 shadow-lg rounded-4 overflow-hidden">
                      
                      <!-- Header -->
                      <div class="modal-header border-0 bg-gradient text-white" style="background-color: #3c3c51;">
                        <h5 class="modal-title fw-semibold d-flex align-items-center">
                          <i class="bi bi-exclamation-triangle-fill text-warning me-2"></i> Konfirmasi Hapus
                        </h5>
                        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                      </div>

                      <!-- Body -->
                      <div class="modal-body text-center py-4 px-5 bg-light">
                        <i class="bi bi-exclamation-triangle text-danger" style="font-size: 2.5rem;"></i>
                        <p class="mt-3 fs-5 text-dark">
                          Yakin ingin menghapus data karyawan<br>
                          <b class="text-danger"><%= k.nama_lengkap %></b>?
                        </p>
                      </div>

                      <!-- Footer -->
                      <div class="modal-footer justify-content-center bg-white border-0 pb-4">
                        <button type="button" 
                                class="btn btn-outline-secondary rounded-pill d-flex align-items-center justify-content-center"
                                style="min-width: 130px; padding: 10px 0;"
                                data-bs-dismiss="modal">
                          <i class="bi bi-x-circle me-2"></i> Batal
                        </button>

                        <form method="POST" action="/admin_Hrd/karyawan/delete/<%= k.id_karyawan %>" class="d-inline">
                          <button type="submit" 
                                  class="btn btn-danger rounded-pill d-flex align-items-center justify-content-center"
                                  style="min-width: 130px; padding: 10px 0;">
                            <i class="bi bi-trash me-2"></i> Hapus
                          </button>
                        </form>
                      </div>

                    </div>
                  </div>
                </div>


              <% }) %>
            <% } %>

              <!-- ==================== MODAL TAMBAH KARYAWAN (MODERN DARK VERSION) ==================== -->
              <div class="modal fade" id="modalTambahKaryawan" tabindex="-1" aria-hidden="true">
                <div class="modal-dialog modal-lg modal-dialog-centered">
                  <div class="modal-content border-0 shadow-lg rounded-4 overflow-hidden" style="background-color: #3c3c51; color: #fff;">
                    
                    <form action="/admin_Hrd/data_karyawan/add" method="POST">

                      <!-- Header -->
                      <div class="modal-header border-0" style="background-color: #2e2e42;">
                        <h5 class="modal-title fw-semibold d-flex align-items-center">
                          <i class="bi bi-person-plus-fill text-warning me-2"></i> Tambah Karyawan
                        </h5>
                        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                      </div>

                      <!-- Body -->
                      <div class="modal-body px-4 py-4">
                        <div class="row">

                          <!-- LEFT -->
                          <div class="col-md-6">
                            <div class="mb-3 position-relative">
                              <i class="bi bi-person-fill position-absolute top-50 start-0 translate-middle-y ms-3 text-dark opacity-75"></i>
                              <input type="text" class="form-control ps-5 rounded-3 border-0 text-dark"
                                    name="nama_lengkap"
                                    placeholder="Nama Lengkap" required>
                            </div>

                            <div class="mb-3 position-relative">
                              <i class="bi bi-envelope-fill position-absolute top-50 start-0 translate-middle-y ms-3 text-dark opacity-75"></i>
                              <input type="email" class="form-control ps-5 rounded-3 border-0 text-dark"
                                    name="email"
                                    placeholder="Alamat Email" required>
                            </div>

                            <div class="mb-3 position-relative">
                              <i class="bi bi-person-badge-fill position-absolute top-50 start-0 translate-middle-y ms-3 text-dark opacity-75"></i>
                              <select class="form-select ps-5 rounded-3 border-0 text-dark"
                                      name="status_karyawan" required>
                                <option class="text-dark" value="Tetap">Tetap</option>
                                <option class="text-dark" value="Kontrak">Kontrak</option>
                              </select>
                            </div>
                          </div>

                          <!-- RIGHT -->
                          <div class="col-md-6">
                            <div class="mb-3 position-relative">
                              <i class="bi bi-briefcase-fill position-absolute top-50 start-0 translate-middle-y ms-3 text-dark opacity-75"></i>
                              <input type="text" class="form-control ps-5 rounded-3 border-0 text-dark"
                                    name="jenis_karyawan"
                                    placeholder="Jenis Karyawan (Bulanan / Harian)">
                            </div>

                            <div class="mb-3 position-relative">
                              <i class="bi bi-calendar-date-fill position-absolute top-50 start-0 translate-middle-y ms-3 text-dark opacity-75"></i>
                              <input type="date" class="form-control ps-5 rounded-3 border-0 text-dark"
                                    name="tgl_masuk">
                            </div>

                            <div class="mb-3 position-relative">
                              <i class="bi bi-building-fill position-absolute top-50 start-0 translate-middle-y ms-3 text-dark opacity-75"></i>
                              <input type="number" class="form-control ps-5 rounded-3 border-0 text-dark"
                                    name="id_company"
                                    placeholder="ID Company">
                            </div>

                            <div class="mb-3 position-relative">
                              <i class="bi bi-diagram-3-fill position-absolute top-50 start-0 translate-middle-y ms-3 text-dark opacity-75"></i>
                              <input type="number" class="form-control ps-5 rounded-3 border-0 text-dark"
                                    name="id_department"
                                    placeholder="ID Departemen">
                            </div>

                            <div class="mb-3 position-relative">
                              <i class="bi bi-person-workspace position-absolute top-50 start-0 translate-middle-y ms-3 text-dark opacity-75"></i>
                              <input type="number" class="form-control ps-5 rounded-3 border-0 text-dark"
                                    name="id_jabatan"
                                    placeholder="ID Jabatan">
                            </div>
                          </div>
                        </div>
                      </div>

                      <!-- Footer -->
                      <div class="modal-footer border-0 justify-content-center pb-4">
                        <button type="button"
                                class="btn rounded-pill d-flex align-items-center justify-content-center"
                                style="min-width: 130px; padding: 10px 0; background-color: #5c5c7a; color: white;"
                                data-bs-dismiss="modal">
                          <i class="bi bi-x-circle me-2"></i> Batal
                        </button>

                        <button type="submit"
                                class="btn rounded-pill d-flex align-items-center justify-content-center"
                                style="min-width: 130px; padding: 10px 0; background-color: #198754; color: white;">
                          <i class="bi bi-save2-fill me-2"></i> Simpan
                        </button>
                      </div>

                    </form>
                  </div>
                </div>
              </div>
              <!-- ============================ END MODAL TAMBAH KARYAWAN ============================== -->

          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<%- include('partials/footer') %>
